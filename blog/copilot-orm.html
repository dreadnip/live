<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>sluggish, lazy, stupid and unconcerned</title>
    <meta name="description" content="my homepage on the world wide web">
    <meta name="author" content="sander">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/png" href="../images/icon.png">
    <link href="../style.css" rel="stylesheet">
</head>
<body class="flow">
    <h1>Embracing Doctrine DBAL with GitHub Copilot</h1>
    <span class="meta">25 Feb 2024 - 3 minute read</span>
    <p>I've been using the Doctrine ORM for years, and while it is a great project that usually saves you a ton of time, it can also blow up in your face.</p>
    <p>Anyone who has taken a look under the hood knows how much code is involved in hydrating those entities, and on some projects, you might want to avoid the complexity the ORM brings.</p>
    <p>The main upsides of the ORM are of course, easy of use and speed. Adding a couple of attributes on a PHP object is enough to give you full access to all database operations for that object (find, findBy, insert, update, delete, etc...), without having to write any code at all.</p>
    <p>On smaller projects, you might want to take a different approach. For example, you might want to use the Doctrine DBAL layer by itself, without the ORM. This means that you'd have to write the object <-> table mapping yourself, which involves writing a lot of boilerplate code.</p>
    <p>This is where Copilot comes in. I've been taking the DBAL-only approach on a recent side-project and was surprised at how good Copilot is at generating the mapping code you need.</p>
    <h2>The set-up</h2>
    <p>This project uses a SQLite database.</p>
    <p>My database connection lives in an <code>AbstractRepository</code> that my entity repositories extend from.</p>
    <pre class="code-example"><code><span style="color: #3A97D4; font-weight: bold;">&lt;?php<br></span><span style="color: #09814A; font-weight: bold;"><br></span><span style="color: #3A97D4; font-weight: bold;">namespace</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #D87A1A">App</span><span style="color: #333;">;</span><span style="color: #09814A; font-weight: bold;"><br><br></span><span style="color: #3A97D4; font-weight: bold;">use</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #D87A1A">Doctrine\DBAL\Connection</span><span style="color: #333;">;</span><span style="color: #09814A; font-weight: bold;"><br></span><span style="color: #3A97D4; font-weight: bold;">use</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #D87A1A">Doctrine\DBAL\DriverManager</span><span style="color: #333;">;</span><span style="color: #09814A; font-weight: bold;"><br><br></span><span style="color: #3A97D4; font-weight: bold;">class</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #D87A1A">AbstractRepository</span><span style="color: #09814A; font-weight: bold;"><br></span><span style="color: #333;">{</span><span style="color: #09814A; font-weight: bold;"><br>    </span><span style="color: #3A97D4; font-weight: bold;">protected</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #D87A1A">Connection</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #09814A">$connection</span><span style="color: #333;">;</span><span style="color: #09814A; font-weight: bold;"><br><br>    </span><span style="color: #3A97D4; font-weight: bold;">public</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #3A97D4; font-weight: bold;">function</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #D87A1A">__construct</span><span style="color: #333;">(</span><span style="color: #D87A1A">string</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #09814A">$path</span><span style="color: #333;">)</span><span style="color: #09814A; font-weight: bold;"><br>    </span><span style="color: #333;">{</span><span style="color: #09814A; font-weight: bold;"><br>        </span><span style="color: #3A97D4; font-weight: bold;">if</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #333;">(</span><span style="color: #333;">!</span><span style="color: #D87A1A">file_exists</span><span style="color: #333;">(</span><span style="color: #09814A">$path</span><span style="color: #333;">)</span><span style="color: #333;">)</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #333;">{</span><span style="color: #09814A; font-weight: bold;"><br>            </span><span style="color: #3A97D4; font-weight: bold;">new</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #D87A1A">\PDO</span><span style="color: #333;">(</span><span style="color: #333">&#039;sqlite:&#039;</span><span style="color: #333;">.</span><span style="color: #09814A">$path</span><span style="color: #333;">)</span><span style="color: #333;">;</span><span style="color: #09814A; font-weight: bold;"><br>        </span><span style="color: #333;">}</span><span style="color: #09814A; font-weight: bold;"><br><br>        </span><span style="color: #09814A">$this</span><span style="color: #666">-&gt;</span><span style="color: #D87A1A">connection</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #333;">=</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #D87A1A">DriverManager</span><span style="color: #666">::</span><span style="color: #D87A1A">getConnection</span><span style="color: #333;">(</span><span style="color: #333;">[</span><span style="color: #09814A; font-weight: bold;"><br>            </span><span style="color: #333">&#039;path&#039;</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #666">=&gt;</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #09814A">$path</span><span style="color: #333;">,</span><span style="color: #09814A; font-weight: bold;"><br>            </span><span style="color: #333">&#039;driver&#039;</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #666">=&gt;</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #333">&#039;pdo_sqlite&#039;</span><span style="color: #09814A; font-weight: bold;"><br>        </span><span style="color: #333;">]</span><span style="color: #333;">)</span><span style="color: #333;">;</span><span style="color: #09814A; font-weight: bold;"><br>    </span><span style="color: #333;">}</span><span style="color: #09814A; font-weight: bold;"><br></span><span style="color: #333;">}</span></code></pre>
    <p>For this example, I'll create a generic <code>Person</code> entity.</p>
    <pre class="code-example"><code><span style="color: #3A97D4; font-weight: bold;">&lt;?php<br></span><span style="color: #09814A; font-weight: bold;"><br></span><span style="color: #3A97D4; font-weight: bold;">namespace</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #D87A1A">App\Domain</span><span style="color: #333;">;</span><span style="color: #09814A; font-weight: bold;"><br><br></span><span style="color: #3A97D4; font-weight: bold;">class</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #D87A1A">Person</span><span style="color: #09814A; font-weight: bold;"><br></span><span style="color: #333;">{</span><span style="color: #09814A; font-weight: bold;"><br>    </span><span style="color: #3A97D4; font-weight: bold;">public</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #3A97D4; font-weight: bold;">function</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #D87A1A">__construct</span><span style="color: #333;">(</span><span style="color: #09814A; font-weight: bold;"><br>        </span><span style="color: #3A97D4; font-weight: bold;">public</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #D87A1A">string</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #09814A">$firstName</span><span style="color: #333;">,</span><span style="color: #09814A; font-weight: bold;"><br>        </span><span style="color: #3A97D4; font-weight: bold;">public</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #D87A1A">string</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #09814A">$lastName</span><span style="color: #333;">,</span><span style="color: #09814A; font-weight: bold;"><br>        </span><span style="color: #3A97D4; font-weight: bold;">public</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #D87A1A">Role</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #09814A">$role</span><span style="color: #333;">,</span><span style="color: #09814A; font-weight: bold;"><br>        </span><span style="color: #3A97D4; font-weight: bold;">public</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #D87A1A">string</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #09814A">$email</span><span style="color: #333;">,</span><span style="color: #09814A; font-weight: bold;"><br>    </span><span style="color: #333;">)</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #333;">{</span><span style="color: #09814A; font-weight: bold;"><br>    </span><span style="color: #333;">}</span><span style="color: #09814A; font-weight: bold;"><br></span><span style="color: #333;">}</span></code></pre>
    <p>I'll also add a repository class for my <code>Person</code>, extending from my abstract one.</p>
    <pre class="code-example"><code><span style="color: #3A97D4; font-weight: bold;">&lt;?php<br></span><span style="color: #09814A; font-weight: bold;"><br></span><span style="color: #3A97D4; font-weight: bold;">namespace</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #D87A1A">App\Domain</span><span style="color: #333;">;</span><span style="color: #09814A; font-weight: bold;"><br><br></span><span style="color: #3A97D4; font-weight: bold;">use</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #D87A1A">Doctrine\DBAL\Schema\Schema</span><span style="color: #333;">;</span><span style="color: #09814A; font-weight: bold;"><br></span><span style="color: #3A97D4; font-weight: bold;">use</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #D87A1A">Doctrine\DBAL\Types\Types</span><span style="color: #333;">;</span><span style="color: #09814A; font-weight: bold;"><br></span><span style="color: #3A97D4; font-weight: bold;">use</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #D87A1A">App\AbstractRepository</span><span style="color: #333;">;</span><span style="color: #09814A; font-weight: bold;"><br><br></span><span style="color: #3A97D4; font-weight: bold;">class</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #D87A1A">PersonRepository</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #3A97D4; font-weight: bold;">extends</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #D87A1A">AbstractRepository</span><span style="color: #09814A; font-weight: bold;"><br></span><span style="color: #333;">{</span><span style="color: #09814A; font-weight: bold;"><br>    </span><span style="color: #3A97D4; font-weight: bold;">private</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #3A97D4; font-weight: bold;">function</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #D87A1A">initializeTable</span><span style="color: #333;">(</span><span style="color: #333;">)</span><span style="color: #333;">:</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #D87A1A">void</span><span style="color: #09814A; font-weight: bold;"><br>    </span><span style="color: #333;">{</span><span style="color: #09814A; font-weight: bold;"><br>        </span><span style="color: #3A97D4; font-weight: bold;">if</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #333;">(</span><span style="color: #333;">!</span><span style="color: #09814A">$this</span><span style="color: #666">-&gt;</span><span style="color: #D87A1A">connection</span><span style="color: #666">-&gt;</span><span style="color: #D87A1A">createSchemaManager</span><span style="color: #333;">(</span><span style="color: #333;">)</span><span style="color: #666">-&gt;</span><span style="color: #D87A1A">tableExists</span><span style="color: #333;">(</span><span style="color: #333">&#039;person&#039;</span><span style="color: #333;">)</span><span style="color: #333;">)</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #333;">{</span><span style="color: #09814A; font-weight: bold;"><br>            </span><span style="color: #09814A">$schema</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #333;">=</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #3A97D4; font-weight: bold;">new</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #D87A1A">Schema</span><span style="color: #333;">(</span><span style="color: #333;">)</span><span style="color: #333;">;</span><span style="color: #09814A; font-weight: bold;"><br>            </span><span style="color: #09814A">$table</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #333;">=</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #09814A">$schema</span><span style="color: #666">-&gt;</span><span style="color: #D87A1A">createTable</span><span style="color: #333;">(</span><span style="color: #333">&#039;person&#039;</span><span style="color: #333;">)</span><span style="color: #333;">;</span><span style="color: #09814A; font-weight: bold;"><br>            </span><span style="color: #09814A">$table</span><span style="color: #666">-&gt;</span><span style="color: #D87A1A">addColumn</span><span style="color: #333;">(</span><span style="color: #333">&#039;id&#039;</span><span style="color: #333;">,</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #D87A1A">Types</span><span style="color: #666">::</span><span style="color: #D87A1A">INTEGER</span><span style="color: #333;">,</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #333;">[</span><span style="color: #333">&#039;autoincrement&#039;</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #666">=&gt;</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #D87A1A">true</span><span style="color: #333;">]</span><span style="color: #333;">)</span><span style="color: #333;">;</span><span style="color: #09814A; font-weight: bold;"><br>            </span><span style="color: #09814A">$table</span><span style="color: #666">-&gt;</span><span style="color: #D87A1A">addColumn</span><span style="color: #333;">(</span><span style="color: #333">&#039;first_name&#039;</span><span style="color: #333;">,</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #D87A1A">Types</span><span style="color: #666">::</span><span style="color: #D87A1A">STRING</span><span style="color: #333;">)</span><span style="color: #333;">;</span><span style="color: #09814A; font-weight: bold;"><br>            </span><span style="color: #09814A">$table</span><span style="color: #666">-&gt;</span><span style="color: #D87A1A">addColumn</span><span style="color: #333;">(</span><span style="color: #333">&#039;last_name&#039;</span><span style="color: #333;">,</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #D87A1A">Types</span><span style="color: #666">::</span><span style="color: #D87A1A">STRING</span><span style="color: #333;">)</span><span style="color: #333;">;</span><span style="color: #09814A; font-weight: bold;"><br>            </span><span style="color: #09814A">$table</span><span style="color: #666">-&gt;</span><span style="color: #D87A1A">addColumn</span><span style="color: #333;">(</span><span style="color: #333">&#039;role&#039;</span><span style="color: #333;">,</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #D87A1A">Types</span><span style="color: #666">::</span><span style="color: #D87A1A">STRING</span><span style="color: #333;">)</span><span style="color: #333;">;</span><span style="color: #09814A; font-weight: bold;"><br>            </span><span style="color: #09814A">$table</span><span style="color: #666">-&gt;</span><span style="color: #D87A1A">addColumn</span><span style="color: #333;">(</span><span style="color: #333">&#039;email&#039;</span><span style="color: #333;">,</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #D87A1A">Types</span><span style="color: #666">::</span><span style="color: #D87A1A">STRING</span><span style="color: #333;">)</span><span style="color: #333;">;</span><span style="color: #09814A; font-weight: bold;"><br>            </span><span style="color: #09814A">$table</span><span style="color: #666">-&gt;</span><span style="color: #D87A1A">addColumn</span><span style="color: #333;">(</span><span style="color: #333">&#039;password&#039;</span><span style="color: #333;">,</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #D87A1A">Types</span><span style="color: #666">::</span><span style="color: #D87A1A">STRING</span><span style="color: #333;">)</span><span style="color: #333;">;</span><span style="color: #09814A; font-weight: bold;"><br>            </span><span style="color: #09814A">$table</span><span style="color: #666">-&gt;</span><span style="color: #D87A1A">setPrimaryKey</span><span style="color: #333;">(</span><span style="color: #333;">[</span><span style="color: #333">&#039;id&#039;</span><span style="color: #333;">]</span><span style="color: #333;">)</span><span style="color: #333;">;</span><span style="color: #09814A; font-weight: bold;"><br><br>            </span><span style="color: #09814A">$this</span><span style="color: #666">-&gt;</span><span style="color: #D87A1A">connection</span><span style="color: #666">-&gt;</span><span style="color: #D87A1A">createSchemaManager</span><span style="color: #333;">(</span><span style="color: #333;">)</span><span style="color: #666">-&gt;</span><span style="color: #D87A1A">createSchemaObjects</span><span style="color: #333;">(</span><span style="color: #09814A">$schema</span><span style="color: #333;">)</span><span style="color: #333;">;</span><span style="color: #09814A; font-weight: bold;"><br>        </span><span style="color: #333;">}</span><span style="color: #09814A; font-weight: bold;"><br>    </span><span style="color: #333;">}</span><span style="color: #09814A; font-weight: bold;"><br></span><span style="color: #333;">}</span></code></pre>
    <p>The repository includes an <code>initializeTable</code> method to create my schema from PHP. This leverages the included Doctrine DBAL types and makes my code portable across different database versions. Copilot already starts pulling its weight here, all of the <code>$table->addColumn</code> calls are auto-generated based on my entity. Copilot correctly guesses the DBAL type that matches the PHP typehint on my entity object.</p>
    <p>Now, we have an entity and an empty table, but no interaction or hydration. Since we're not using an ORM, we have to write our own methods. Let's add some.</p>
    <p>With Copilot, typing a descriptive function name and including a valid return type is enough to generate exactly what I want. The grey text in the following screenshot is an example of Copilot correctly guessing my intention and suggesting the exact code I need.</p>
    <figure><img src="copilot.png" alt="copilot generating ORM code"></figure>
    <p></p>
    <p>This way, I end up only with the methods I need, and everything is very explicit.</p>
    <p>The following repository took me 2 minutes to make, I only typed the function names and Copilot suggested everything correctly.</p>
    <pre class="code-example"><code><span style="color: #3A97D4; font-weight: bold;">&lt;?php<br></span><span style="color: #09814A; font-weight: bold;"><br></span><span style="color: #3A97D4; font-weight: bold;">namespace</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #D87A1A">App\Domain</span><span style="color: #333;">;</span><span style="color: #09814A; font-weight: bold;"><br><br></span><span style="color: #3A97D4; font-weight: bold;">use</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #D87A1A">Doctrine\DBAL\Schema\Schema</span><span style="color: #333;">;</span><span style="color: #09814A; font-weight: bold;"><br></span><span style="color: #3A97D4; font-weight: bold;">use</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #D87A1A">Doctrine\DBAL\Types\Types</span><span style="color: #333;">;</span><span style="color: #09814A; font-weight: bold;"><br></span><span style="color: #3A97D4; font-weight: bold;">use</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #D87A1A">App\AbstractRepository</span><span style="color: #333;">;</span><span style="color: #09814A; font-weight: bold;"><br><br></span><span style="color: #3A97D4; font-weight: bold;">class</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #D87A1A">PersonRepository</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #3A97D4; font-weight: bold;">extends</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #D87A1A">AbstractRepository</span><span style="color: #09814A; font-weight: bold;"><br></span><span style="color: #333;">{</span><span style="color: #09814A; font-weight: bold;"><br>    </span><span style="color: #3A97D4; font-weight: bold;">private</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #3A97D4; font-weight: bold;">function</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #D87A1A">initializeTable</span><span style="color: #333;">(</span><span style="color: #333;">)</span><span style="color: #333;">:</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #D87A1A">void</span><span style="color: #09814A; font-weight: bold;"><br>    </span><span style="color: #333;">{</span><span style="color: #09814A; font-weight: bold;"><br>        </span><span style="color: #3A97D4; font-weight: bold;">if</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #333;">(</span><span style="color: #333;">!</span><span style="color: #09814A">$this</span><span style="color: #666">-&gt;</span><span style="color: #D87A1A">connection</span><span style="color: #666">-&gt;</span><span style="color: #D87A1A">createSchemaManager</span><span style="color: #333;">(</span><span style="color: #333;">)</span><span style="color: #666">-&gt;</span><span style="color: #D87A1A">tableExists</span><span style="color: #333;">(</span><span style="color: #333">&#039;person&#039;</span><span style="color: #333;">)</span><span style="color: #333;">)</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #333;">{</span><span style="color: #09814A; font-weight: bold;"><br>            </span><span style="color: #09814A">$schema</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #333;">=</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #3A97D4; font-weight: bold;">new</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #D87A1A">Schema</span><span style="color: #333;">(</span><span style="color: #333;">)</span><span style="color: #333;">;</span><span style="color: #09814A; font-weight: bold;"><br>            </span><span style="color: #09814A">$table</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #333;">=</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #09814A">$schema</span><span style="color: #666">-&gt;</span><span style="color: #D87A1A">createTable</span><span style="color: #333;">(</span><span style="color: #333">&#039;person&#039;</span><span style="color: #333;">)</span><span style="color: #333;">;</span><span style="color: #09814A; font-weight: bold;"><br>            </span><span style="color: #09814A">$table</span><span style="color: #666">-&gt;</span><span style="color: #D87A1A">addColumn</span><span style="color: #333;">(</span><span style="color: #333">&#039;id&#039;</span><span style="color: #333;">,</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #D87A1A">Types</span><span style="color: #666">::</span><span style="color: #D87A1A">INTEGER</span><span style="color: #333;">,</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #333;">[</span><span style="color: #333">&#039;autoincrement&#039;</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #666">=&gt;</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #D87A1A">true</span><span style="color: #333;">]</span><span style="color: #333;">)</span><span style="color: #333;">;</span><span style="color: #09814A; font-weight: bold;"><br>            </span><span style="color: #09814A">$table</span><span style="color: #666">-&gt;</span><span style="color: #D87A1A">addColumn</span><span style="color: #333;">(</span><span style="color: #333">&#039;first_name&#039;</span><span style="color: #333;">,</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #D87A1A">Types</span><span style="color: #666">::</span><span style="color: #D87A1A">STRING</span><span style="color: #333;">)</span><span style="color: #333;">;</span><span style="color: #09814A; font-weight: bold;"><br>            </span><span style="color: #09814A">$table</span><span style="color: #666">-&gt;</span><span style="color: #D87A1A">addColumn</span><span style="color: #333;">(</span><span style="color: #333">&#039;last_name&#039;</span><span style="color: #333;">,</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #D87A1A">Types</span><span style="color: #666">::</span><span style="color: #D87A1A">STRING</span><span style="color: #333;">)</span><span style="color: #333;">;</span><span style="color: #09814A; font-weight: bold;"><br>            </span><span style="color: #09814A">$table</span><span style="color: #666">-&gt;</span><span style="color: #D87A1A">addColumn</span><span style="color: #333;">(</span><span style="color: #333">&#039;role&#039;</span><span style="color: #333;">,</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #D87A1A">Types</span><span style="color: #666">::</span><span style="color: #D87A1A">STRING</span><span style="color: #333;">)</span><span style="color: #333;">;</span><span style="color: #09814A; font-weight: bold;"><br>            </span><span style="color: #09814A">$table</span><span style="color: #666">-&gt;</span><span style="color: #D87A1A">addColumn</span><span style="color: #333;">(</span><span style="color: #333">&#039;email&#039;</span><span style="color: #333;">,</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #D87A1A">Types</span><span style="color: #666">::</span><span style="color: #D87A1A">STRING</span><span style="color: #333;">)</span><span style="color: #333;">;</span><span style="color: #09814A; font-weight: bold;"><br>            </span><span style="color: #09814A">$table</span><span style="color: #666">-&gt;</span><span style="color: #D87A1A">addColumn</span><span style="color: #333;">(</span><span style="color: #333">&#039;password&#039;</span><span style="color: #333;">,</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #D87A1A">Types</span><span style="color: #666">::</span><span style="color: #D87A1A">STRING</span><span style="color: #333;">)</span><span style="color: #333;">;</span><span style="color: #09814A; font-weight: bold;"><br>            </span><span style="color: #09814A">$table</span><span style="color: #666">-&gt;</span><span style="color: #D87A1A">setPrimaryKey</span><span style="color: #333;">(</span><span style="color: #333;">[</span><span style="color: #333">&#039;id&#039;</span><span style="color: #333;">]</span><span style="color: #333;">)</span><span style="color: #333;">;</span><span style="color: #09814A; font-weight: bold;"><br><br>            </span><span style="color: #09814A">$this</span><span style="color: #666">-&gt;</span><span style="color: #D87A1A">connection</span><span style="color: #666">-&gt;</span><span style="color: #D87A1A">createSchemaManager</span><span style="color: #333;">(</span><span style="color: #333;">)</span><span style="color: #666">-&gt;</span><span style="color: #D87A1A">createSchemaObjects</span><span style="color: #333;">(</span><span style="color: #09814A">$schema</span><span style="color: #333;">)</span><span style="color: #333;">;</span><span style="color: #09814A; font-weight: bold;"><br>        </span><span style="color: #333;">}</span><span style="color: #09814A; font-weight: bold;"><br>    </span><span style="color: #333;">}</span><span style="color: #09814A; font-weight: bold;"><br><br>    </span><span style="color: #3A97D4; font-weight: bold;">public</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #3A97D4; font-weight: bold;">function</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #D87A1A">getPeople</span><span style="color: #333;">(</span><span style="color: #333;">)</span><span style="color: #333;">:</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #3A97D4; font-weight: bold;">array</span><span style="color: #09814A; font-weight: bold;"><br>    </span><span style="color: #333;">{</span><span style="color: #09814A; font-weight: bold;"><br>        </span><span style="color: #09814A">$rows</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #333;">=</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #09814A">$this</span><span style="color: #666">-&gt;</span><span style="color: #D87A1A">connection</span><span style="color: #666">-&gt;</span><span style="color: #D87A1A">createQueryBuilder</span><span style="color: #333;">(</span><span style="color: #333;">)</span><span style="color: #09814A; font-weight: bold;"><br>            </span><span style="color: #666">-&gt;</span><span style="color: #D87A1A">select</span><span style="color: #333;">(</span><span style="color: #333">&#039;*&#039;</span><span style="color: #333;">)</span><span style="color: #09814A; font-weight: bold;"><br>            </span><span style="color: #666">-&gt;</span><span style="color: #D87A1A">from</span><span style="color: #333;">(</span><span style="color: #333">&#039;person&#039;</span><span style="color: #333;">)</span><span style="color: #09814A; font-weight: bold;"><br>            </span><span style="color: #666">-&gt;</span><span style="color: #D87A1A">executeQuery</span><span style="color: #333;">(</span><span style="color: #333;">)</span><span style="color: #09814A; font-weight: bold;"><br>            </span><span style="color: #666">-&gt;</span><span style="color: #D87A1A">fetchAllAssociative</span><span style="color: #333;">(</span><span style="color: #333;">)</span><span style="color: #333;">;</span><span style="color: #09814A; font-weight: bold;"><br><br>        </span><span style="color: #3A97D4; font-weight: bold;">return</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #D87A1A">array_map</span><span style="color: #333;">(</span><span style="color: #3A97D4; font-weight: bold;">function</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #333;">(</span><span style="color: #3A97D4; font-weight: bold;">array</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #09814A">$row</span><span style="color: #333;">)</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #333;">{</span><span style="color: #09814A; font-weight: bold;"><br>            </span><span style="color: #3A97D4; font-weight: bold;">return</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #3A97D4; font-weight: bold;">new</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #D87A1A">Person</span><span style="color: #333;">(</span><span style="color: #09814A; font-weight: bold;"><br>                </span><span style="color: #09814A">$row</span><span style="color: #333;">[</span><span style="color: #333">&#039;first_name&#039;</span><span style="color: #333;">]</span><span style="color: #333;">,</span><span style="color: #09814A; font-weight: bold;"><br>                </span><span style="color: #09814A">$row</span><span style="color: #333;">[</span><span style="color: #333">&#039;last_name&#039;</span><span style="color: #333;">]</span><span style="color: #333;">,</span><span style="color: #09814A; font-weight: bold;"><br>                </span><span style="color: #D87A1A">Role</span><span style="color: #666">::</span><span style="color: #D87A1A">from</span><span style="color: #333;">(</span><span style="color: #09814A">$row</span><span style="color: #333;">[</span><span style="color: #333">&#039;role&#039;</span><span style="color: #333;">]</span><span style="color: #333;">)</span><span style="color: #333;">,</span><span style="color: #09814A; font-weight: bold;"><br>                </span><span style="color: #09814A">$row</span><span style="color: #333;">[</span><span style="color: #333">&#039;email&#039;</span><span style="color: #333;">]</span><span style="color: #333;">,</span><span style="color: #09814A; font-weight: bold;"><br>            </span><span style="color: #333;">)</span><span style="color: #333;">;</span><span style="color: #09814A; font-weight: bold;"><br>        </span><span style="color: #333;">}</span><span style="color: #333;">,</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #09814A">$rows</span><span style="color: #333;">)</span><span style="color: #333;">;</span><span style="color: #09814A; font-weight: bold;"><br>    </span><span style="color: #333;">}</span><span style="color: #09814A; font-weight: bold;"><br><br>    </span><span style="color: #3A97D4; font-weight: bold;">public</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #3A97D4; font-weight: bold;">function</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #D87A1A">createPerson</span><span style="color: #333;">(</span><span style="color: #D87A1A">PersonDataTransferObject</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #09814A">$personDataTransferObject</span><span style="color: #333;">)</span><span style="color: #09814A; font-weight: bold;"><br>    </span><span style="color: #333;">{</span><span style="color: #09814A; font-weight: bold;"><br>        </span><span style="color: #09814A">$this</span><span style="color: #666">-&gt;</span><span style="color: #D87A1A">connection</span><span style="color: #666">-&gt;</span><span style="color: #D87A1A">insert</span><span style="color: #333;">(</span><span style="color: #333">&#039;person&#039;</span><span style="color: #333;">,</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #333;">[</span><span style="color: #09814A; font-weight: bold;"><br>            </span><span style="color: #333">&#039;first_name&#039;</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #666">=&gt;</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #09814A">$personDataTransferObject</span><span style="color: #666">-&gt;</span><span style="color: #D87A1A">firstName</span><span style="color: #333;">,</span><span style="color: #09814A; font-weight: bold;"><br>            </span><span style="color: #333">&#039;last_name&#039;</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #666">=&gt;</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #09814A">$personDataTransferObject</span><span style="color: #666">-&gt;</span><span style="color: #D87A1A">lastName</span><span style="color: #333;">,</span><span style="color: #09814A; font-weight: bold;"><br>            </span><span style="color: #333">&#039;role&#039;</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #666">=&gt;</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #09814A">$personDataTransferObject</span><span style="color: #666">-&gt;</span><span style="color: #D87A1A">role</span><span style="color: #666">-&gt;</span><span style="color: #D87A1A">value</span><span style="color: #333;">,</span><span style="color: #09814A; font-weight: bold;"><br>            </span><span style="color: #333">&#039;email&#039;</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #666">=&gt;</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #09814A">$personDataTransferObject</span><span style="color: #666">-&gt;</span><span style="color: #D87A1A">email</span><span style="color: #333;">,</span><span style="color: #09814A; font-weight: bold;"><br>            </span><span style="color: #333">&#039;password&#039;</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #666">=&gt;</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #D87A1A">password_hash</span><span style="color: #333;">(</span><span style="color: #09814A">$personDataTransferObject</span><span style="color: #666">-&gt;</span><span style="color: #D87A1A">password</span><span style="color: #333;">,</span><span style="color: #09814A; font-weight: bold;"> </span><span style="color: #D87A1A">PASSWORD_DEFAULT</span><span style="color: #333;">)</span><span style="color: #333;">,</span><span style="color: #09814A; font-weight: bold;"><br>        </span><span style="color: #333;">]</span><span style="color: #333;">)</span><span style="color: #333;">;</span><span style="color: #09814A; font-weight: bold;"><br>    </span><span style="color: #333;">}</span><span style="color: #09814A; font-weight: bold;"><br></span><span style="color: #333;">}</span></code></pre>
    <h2>The good</h2>
    <ul class="list-circle">
        <li>We still use the Doctrine DBAL, so we keep the nice features: schema introspection, migrations, querybuilder, etc...</li>
        <li>No bloat on the repositories, only the methods I need</li>
        <li>Everything is strongly typed. No extra extensions required to make phpstan understand our repositories.</li>
        <li>No relying on magic methods. Methods actually exists on the repository and can be inspected when needed.</li>
        <li>Copilot can handle conversion for built-in classes like DateTime, enums, value objects, etc... without much trouble.</li>
        <li>Since you control the tables and column names, there's no need to reach for ORM features like embeddables and table inheritance to fit your domain logic into Doctrine entities.</li>
    </ul>
    <h2>The bad</h2>
    <ul class="list-circle">
        <li>I still invest more time than I would with the ORM, though only minimally</li>
        <li>Maintenance is higher. When the entity changes later on, for example we add a new property, our repository methods don't auto-magically work with the new field. We'd have to go in and update them. I don't mind this honestly, since I prefer working explicitly.</li>
    </ul>
    <h2>Conclusion</h2>
    <p>So far I've been really enjoying it. If you've been dreaming of ditching your PHP ORM, I'd suggest you give it a shot and letting me know how far you got.</p>
    <footer>
        <a href="/">Go back home</a>
    </footer>
</body>
</html>